{{ config(materialized='view',
    partition_by={
      "field": "game_timestamp",
      "data_type": "timestamp",
      "granularity": "day"
    }
)}}

SELECT

    play_id,
    game_id,
    home_team,
    away_team,
    season_type,
    week,
    posteam,
    posteam_type,
    defteam,
    side_of_field,
    yardline_100,
    game_date,
    quarter_seconds_remaining,
    half_seconds_remaining,
    game_seconds_remaining,
    game_half,
    quarter_end,
    sp,
    qtr,
    down,
    `time`,
    yrdln,
    ydstogo,
    ydsnet,
    `desc`,
    play_type,
    yards_gained,
    shotgun,
    no_huddle,
    qb_dropback,
    qb_kneel,
    qb_spike,
    qb_scramble,
    pass_location,
    air_yards,
    yards_after_catch,
    run_location,
    run_gap,
    field_goal_result,
    kick_distance,
    extra_point_result,
    two_point_conv_result,
    home_timeouts_remaining,
    away_timeouts_remaining,
    timeout,
    timeout_team,
    td_team,
    td_player_name,
    td_player_id,
    total_home_score,
    total_away_score,
    posteam_score,
    defteam_score,
    score_differential,
    epa,
    ep,
    punt_blocked,
    incomplete_pass,
    touchback,
    interception,
    fumble_forced,
    fumble_not_forced,
    fumble_out_of_bounds,
    solo_tackle,
    `safety`,
    penalty,
    tackled_for_loss,
    fumble_lost,
    own_kickoff_recovery,
    own_kickoff_recovery_td,
    qb_hit,
    rush_attempt,
    pass_attempt,
    sack,
    touchdown,
    pass_touchdown,
    rush_touchdown,
    return_touchdown,
    extra_point_attempt,
    two_point_attempt,
    field_goal_attempt,
    kickoff_attempt,
    punt_attempt,
    fumble,
    complete_pass,
    assist_tackle,
    passer_player_name,
    passing_yards,
    receiver_player_id,
    receiver_player_name,
    receiving_yards,
    rusher_player_id,
    rusher_player_name,
    rushing_yards,
    interception_player_id,
    interception_player_name,
    punt_returner_player_id,
    punt_returner_player_name,
    kickoff_returner_player_name,
    kickoff_returner_player_id,
    blocked_player_id,
    blocked_player_name,
    tackle_for_loss_1_player_id,
    tackle_for_loss_1_player_name,
    qb_hit_1_player_id,
    qb_hit_1_player_name,
    qb_hit_2_player_id,
    qb_hit_2_player_name,
    forced_fumble_player_1_team,
    forced_fumble_player_1_player_id,
    forced_fumble_player_1_player_name,
    forced_fumble_player_2_team,
    forced_fumble_player_2_player_id,
    forced_fumble_player_2_player_name,
    solo_tackle_1_team,
    solo_tackle_2_team,
    solo_tackle_1_player_id,
    solo_tackle_2_player_id,
    solo_tackle_1_player_name,
    solo_tackle_2_player_name,
    assist_tackle_1_player_id,
    assist_tackle_1_player_name,
    assist_tackle_1_team,
    assist_tackle_2_player_id,
    assist_tackle_2_player_name,
    assist_tackle_2_team,
    tackle_with_assist,
    sack_player_id,
    sack_player_name,
    half_sack_1_player_id,
    half_sack_1_player_name,
    half_sack_2_player_id,
    half_sack_2_player_name,
    return_team,
    return_yards,
    penalty_team,
    penalty_player_id,
    penalty_player_name,
    penalty_yards,
    replay_or_challenge,
    replay_or_challenge_result,
    safety_player_name,
    safety_player_id,
    season,
    cp,
    cpoe,
    series,
    series_success,
    series_result,
    start_time,
    time_of_day,
    stadium,
    weather,
    drive_play_count,
    drive_time_of_possession,
    drive_first_downs,
    drive_inside20,
    drive_ended_with_score,
    drive_quarter_start,
    drive_quarter_end,
    drive_yards_penalized,
    drive_start_transition,
    drive_end_transition,
    drive_start_yard_line,
    drive_end_yard_line,
    away_score,
    home_score,
    result,
    div_game,
    roof,
    surface,
    `temp`,
    home_coach,
    away_coach,
    game_stadium,
    success,
    passer,
    rusher,
    receiver,
    pass,
    rush,
    first_down,
    special,
    passer_id,
    rusher_id,
    receiver_id,
    fantasy_player_name,
    fantasy_player_id,
    out_of_bounds,

    CAST(drive AS NUMERIC) AS DRIVE,
    CAST(goal_to_go AS INTEGER) AS goal_to_go,
    -- CAST(tackle_for_loss_2_player_id AS STRING) AS tackle_for_loss_2_player_id,
    -- CAST(tackle_for_loss_2_player_name AS STRING) AS tackle_for_loss_2_player_name,

    PARSE_TIMESTAMP('%F', game_date) AS game_timestamp

FROM {{ source('staging','external_pbp_data') }}



